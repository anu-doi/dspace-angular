<ds-page-with-sidebar [id]="'statistics-page'" [sidebarContent]="sidebarContent">
  <ng-template *ngTemplateOutlet="statisticsContent"></ng-template>
</ds-page-with-sidebar>
<ng-template #statisticsContent>
  <ng-container *ngVar="(scope$ | async) as scope">
    <div class="d-flex justify-content-between">
      <h2 *ngIf="scope" class="header" id="{{ scope.id }}">
        {{ 'statistics.header' | translate: { scope: getName(scope) } }}
      </h2>
      <button (click)="writeData()" class="export-button btn btn-dark btn-sm" title="Export statistics as CSV"
        aria-label="Export statistics as CSV"><i class="fas fa-file-export fa-fw"></i></button>
    </div>
  </ng-container>

  <ng-container *ngVar="(reports$ | async) as reports">
    <ng-container *ngIf="!reports">
      <ds-themed-loading></ds-themed-loading>
    </ng-container>
    <ng-container *ngIf="reports">
      <ds-statistics-table *ngFor="let report of reports" [selectedValue]="selectedValue" [report]="report"
        class="m-2 {{ report.id }}">
      </ds-statistics-table>
      <ng-container *ngFor="let report of reports">
        <ds-total-views-downloads *ngIf="report.reportType === 'TotalVisitsDownloads'" [report]="report"></ds-total-views-downloads>
      </ng-container>
      <!-- <div>{{ hasData$ }}</div> -->
      <div *ngIf="!(hasData$ | async)">
        {{ 'statistics.page.no-data' | translate }}
      </div>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #sidebarContent>
  <div class="setting-option mb-3 p-3">
    <h5>
      <label id="viewbyfilter" for="optselect">View By</label>
    </h5>
    <select id="optselect" [(ngModel)]="selectedValue" class="form-control" (change)="onOptionsSelected(selectedValue)">
      <option *ngFor="let type of types" [value]='type'>{{ type }}</option>
    </select>
  </div>
  <div class="setting-option mb-3 p-3" id="selectitems">
    <h5>
      <label id="topitemslabel" for="sitefilter">Display top items</label>
    </h5>
    <input type="number" id="sitefilter" [(ngModel)]="filterValue" class="form-control"
      (keyup)="onNumberChange(filterValue)" placeholder="Enter a number to filter">
  </div>

  <form class="w-200" [formGroup]="formData">
    <div class="setting-option mb-3 p-3">
      <h5>
        <label aria-label="datefilter">Filter</label>
      </h5>
      <div class="col-6 form-group mb-0">
        <ds-date-picker-range (dateChange)="getChangeFromDatePicker($event)"></ds-date-picker-range>
      </div>
    </div>
  </form>
</ng-template>
